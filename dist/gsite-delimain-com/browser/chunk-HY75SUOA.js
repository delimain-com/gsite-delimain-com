import{a as J}from"./chunk-VE7JULOV.js";import{b as z,c as G,f as H,h as K,i as X,j as Y,k as Z,l as ee,n as te,p as ie}from"./chunk-RR3BJK5N.js";import{a as U}from"./chunk-6NDLDMWB.js";import{A as j,C as Q,e as O,l as B,p as I,x as f}from"./chunk-PXBPTLID.js";import{Ab as y,Gb as E,J as u,Kb as b,Lb as d,S as F,U as C,Va as l,Wb as w,Yb as c,a as S,b as D,da as m,fb as q,ic as W,ja as _,ka as v,kc as A,lc as R,mc as k,na as V,qc as T,rb as h,sb as x,ua as p,ub as N,vb as L,wb as $,xb as g,yb as a,yc as P,zb as o}from"./chunk-SHRHIQVS.js";var ne=()=>[1,5,10,30,50,100,500,100],oe=(i,t)=>({uid:i,domain:t}),ae=(i,t)=>t.uid;function se(i,t){if(i&1&&(y(0,"option",12),R(1,"number")),i&2){let e=t.$implicit;g("ngValue",e)("textContent",k(1,2,e))}}function re(i,t){if(i&1&&y(0,"span",15),i&2){let e=d(2);g("textContent",e.$eventListCount())}}function le(i,t){if(i&1){let e=E();a(0,"tr")(1,"td"),y(2,"a",19),o(),a(3,"td")(4,"div",20)(5,"button",21),b("click",function(){let s=_(e).$implicit,r=d(3);return v(r.action_event_viewFlag(s))}),o(),a(6,"button",22),b("click",function(){let s=_(e).$implicit,r=d(3);return v(r.action_remove_event(s))}),c(7," \u524A\u9664 "),o()()()()}if(i&2){let e=t.$implicit,n=d(3);l(2),g("queryParams",A(5,oe,e.uid,n.siteInfo.$domain()))("textContent",e.title),l(3),w("btn-success",e.viewFlag),g("textContent",e.viewFlag?"\u8868\u793A\u4E2D":"\u975E\u8868\u793A")}}function de(i,t){i&1&&(a(0,"div",6)(1,"table",17)(2,"thead")(3,"tr",18)(4,"th"),c(5,"\u30BF\u30A4\u30C8\u30EB"),o(),a(6,"th"),c(7,"\u64CD\u4F5C"),o()()(),a(8,"tbody"),L(9,le,8,8,"tr",null,ae),o()()()),i&2&&(l(9),$(t))}function ce(i,t){if(i&1){let e=E();a(0,"div",0)(1,"div",1)(2,"strong"),c(3,"\u30A4\u30D9\u30F3\u30C8\u4E00\u89A7"),o()(),a(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"span"),c(9,"\u691C\u7D22"),o()(),a(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9),c(14,"\u30BF\u30A4\u30C8\u30EB"),o(),a(15,"input",10),b("ngModelChange",function(s){_(e);let r=d();return r.$q_title.set(s),v(r.action_load_eventList())}),o()(),a(16,"div",8)(17,"div",9),c(18,"\u8868\u793A\u4EF6\u6570"),o(),a(19,"select",11),b("ngModelChange",function(s){_(e);let r=d();return r.$q_limit.set(s),v(r.action_load_eventList())}),L(20,se,2,4,"option",12,N),o()(),a(22,"div",8)(23,"div",9),c(24,"\u30DA\u30FC\u30B8"),o(),a(25,"input",13),b("ngModelChange",function(s){_(e);let r=d();return r.$q_page.set(s),v(r.action_load_eventList())})("wheel",function(){_(e);let s=d();return v(s.util.noop())}),o()()()()(),a(26,"div",4)(27,"div",5)(28,"div",14)(29,"div")(30,"span"),c(31,"\u4E00\u89A7"),o(),h(32,re,1,1,"span",15),o(),a(33,"div")(34,"i",16),b("click",function(){_(e);let s=d();return v(s.action_load_eventList())}),o()()()(),h(35,de,11,0,"div",6),o()()()()}if(i&2){let e,n=d();l(15),g("ngModel",n.$q_title()),l(4),g("ngModel",n.$q_limit()),l(),$(W(8,ne)),l(5),g("min",1)("ngModel",n.$q_page());let s=n.$eventListCount();l(7),x(n.util.isNumber(s)?32:-1),l(2),w("fa-spin",n.$load_eventList_isWait()),l(),x((e=n.$eventList())?35:-1,e)}}function pe(i,t){i&1&&(a(0,"div"),c(1,"loading..."),o())}var M=class i{#e=m(V);util=m(Q);changeDetectorRef=m(P);notifyMessage=m(ie);api=m(j);siteInfo=m(J);activatedRoute=m(B);$queryParams=U();$q_title=p(void 0);$q_page=p(1);$q_limit=p(100);$params=T(()=>{let t={query:{}};return t.query.title=this.$q_title()||"",t});$isReady=p(!1);$eventList=p(void 0);$eventListCount=p(void 0);constructor(){this.activatedRoute.queryParams.pipe(C(()=>this.$isReady.set(!1)),F(()=>this.load()),C(()=>this.$isReady.set(!0))).subscribe()}$load_isWait=p(!1);load(){this.$load_isWait.set(!0),this.$eventList.set(void 0),this.$eventListCount.set(void 0);let t=this.$params();return this.api.post("page/eventList/load",t).pipe(f(this.#e),C(({results:e})=>{this.$eventList.set(e.eventList||[]),this.$eventListCount.set(e.eventListCount||0),this.$load_isWait.set(!1)}),u(1))}$load_eventList_isWait=p(!1);load_eventList(){this.$load_eventList_isWait.set(!0),this.$eventList.set(void 0),this.$eventListCount.set(void 0);let t=this.$params();return this.api.post("page/eventList/load_eventList",t).pipe(f(this.#e),C(({results:e})=>{this.$eventList.set(e.eventList||[]),this.$eventListCount.set(e.eventListCount||0),this.$load_eventList_isWait.set(!1)}),u(1))}action_load_eventList(){this.load_eventList().pipe(f(this.#e),u(1)).subscribe()}remove_event(t){let e={event:t};return this.notifyMessage.show("\u524A\u9664\u4E2D..."),this.api.post("page/eventList/remove_event",e).pipe(f(this.#e),C(()=>{this.$eventList.update(n=>n.filter(s=>s.uid!==e.event.uid)),this.notifyMessage.hide("\u524A\u9664\u3057\u307E\u3057\u305F")}),u(1))}action_remove_event(t){confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093")&&this.remove_event(t).pipe(f(this.#e),u(1)).subscribe()}event_viewFlag(t){let e={event:D(S({},t),{viewFlag:!t.viewFlag})};return this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),this.api.post("page/eventList/save_event_viewFlag",e).pipe(f(this.#e),C(()=>{t.viewFlag=e.event.viewFlag,this.changeDetectorRef.detectChanges(),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),u(1))}action_event_viewFlag(t){this.event_viewFlag(t).pipe(f(this.#e),u(1)).subscribe()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=q({type:i,selectors:[["app-event-list"]],decls:2,vars:1,consts:[[1,"card","h-100","rounded-0"],[1,"card-header","p-1"],[1,"card-body","p-1","h-100"],[1,"d-flex","flex-column","gap-1"],[1,"card"],[1,"card-header","p-0","px-1"],[1,"card-body","p-1"],[1,"d-flex","flex-row","gap-1"],[1,"input-group","input-group-sm","w-auto"],[1,"input-group-text"],["type","text",1,"form-control-sm","form-control",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],[3,"ngValue","textContent"],["type","number",1,"form-control","form-control-sm",2,"width","4rem",3,"ngModelChange","wheel","min","ngModel"],[1,"d-flex","justify-content-between","px-1"],[1,"label-count","mx-1",3,"textContent"],[1,"fa","fa-refresh","fa-hover","cursor-pointer",3,"click"],[1,"table","table-sm","table-striped","table-hover","table-bordered","event-list-table"],[1,"table-warning"],["routerLink","/eventEdit",3,"queryParams","textContent"],[1,"d-flex","flex-row","gap-1","justify-content-center"],[1,"btn","btn-sm","border",3,"click","textContent"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(e,n){e&1&&h(0,ce,36,9,"div",0)(1,pe,2,0,"div"),e&2&&x(n.$isReady()?0:1)},dependencies:[I,te,Y,Z,z,K,X,G,ee,H,O],styles:[".event-list-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){width:10rem}"]})};export{M as default};
