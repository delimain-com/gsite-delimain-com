import{a as B,b as z}from"./chunk-LKAHIGVA.js";import{a as A,b as j,e as O,k as U}from"./chunk-KVF2PDD6.js";import{a as T}from"./chunk-RQHXG7CL.js";import{a as Q}from"./chunk-5AHWDRJC.js";import{m as R,t as c,w as P,y as V}from"./chunk-YICIKOJU.js";import{$ as f,Bb as S,Db as y,Eb as p,H as d,Nb as k,Oa as N,Ob as b,Ra as u,S as m,a as _,b as g,bb as E,bc as w,fa as C,fc as q,ga as h,ja as M,mc as I,nb as $,ob as x,qa as r,rb as F,sb as W,tb as v,ub as s,vb as o,wb as L}from"./chunk-DLU3COSW.js";var G=(a,e)=>({domain:a,uid:e}),K=(a,e)=>e.uid;function X(a,e){if(a&1&&L(0,"img",18),a&2){let t=p().$implicit,i=p(2);v("src",e,N)("queryParams",w(2,G,i.navigation.$domain(),t.uid))}}function Y(a,e){if(a&1){let t=S();s(0,"div")(1,"div",12)(2,"div",13),L(3,"i",14),s(4,"i",15),y("click",function(){let n=C(t).$implicit,l=p(2);return h(l.action_remove_cast(n))}),o()(),s(5,"div",16)(6,"div",17),$(7,X,1,5,"img",18),o(),s(8,"div",19),L(9,"a",20),o()(),s(10,"div",21)(11,"button",22),y("click",function(){let n=C(t).$implicit,l=p(2);return h(l.action_cast_viewFlag(n))}),o()()()()}if(a&2){let t,i=e.$implicit,n=p(2);u(7),x((t=i.imageSrc)?7:-1,t),u(2),v("queryParams",w(11,G,n.navigation.$domain(),i.uid))("textContent",i.name),u(2),k("btn-success",i.viewFlag)("border",!i.viewFlag)("disabled",i._==null?null:i._.isWait),v("disabled",i._==null?null:i._.isWait)("textContent",i.viewFlag?"\u516C\u958B\u4E2D":"\u975E\u516C\u958B")}}function Z(a,e){if(a&1){let t=S();s(0,"div",0)(1,"div",1)(2,"strong"),b(3,"\u30AD\u30E3\u30B9\u30C8\u4E00\u89A7"),o()(),s(4,"div",2)(5,"div",3)(6,"div",4)(7,"span"),b(8,"\u691C\u7D22"),o()(),s(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8),b(13," \u30AD\u30E3\u30B9\u30C8\u540D "),o(),s(14,"input",9),y("ngModelChange",function(n){C(t);let l=p();return l.$q_castName.set(n),h(l.action_load_castList())}),o()()()()(),s(15,"div",10)(16,"div",4)(17,"span"),b(18,"\u4E00\u89A7"),o()(),s(19,"div",5)(20,"div",11),F(21,Y,12,14,"div",null,K),o()()()()()}if(a&2){let t=p();u(14),v("ngModel",t.$q_castName()),u(6),v("nxtSortablejs",t.$castList())("config",t.castListSortableOptions),u(),W(t.$castList())}}function tt(a,e){a&1&&(s(0,"div"),b(1,"loading..."),o())}var D=class a{#t=f(M);util=f(V);navigation=f(Q);api=f(P);changeDetectorRef=f(I);castListSortableOptions={handle:".handle",onUpdate:()=>{let e={query:{}};{let t=Date.now(),i=this.$castList()||[];e.castList=i.map(n=>g(_({},n),{sort:t--}))}this.api.post("page/castList/save_castList_sort",e).pipe(c(this.#t),m(()=>this.$castList.set(e.castList)),d(1)).subscribe()}};$isReady=r(!1);$queryParams=T();$q_castName=r("");$pageConfig=r(void 0);$castList=r(void 0);$castListCount=r(void 0);$castImageItem=r(void 0);$castSectionItemList=r(void 0);$params=q(()=>({query:{name:this.$q_castName()}}));constructor(){this.load().pipe(c(this.#t),m(()=>this.$isReady.set(!0)),d(1)).subscribe()}load(){this.$castList.set(void 0);let e=this.$params();return console.log(this.$queryParams()),this.api.post("page/castList/load",e).pipe(c(this.#t),m(({results:t})=>{let{pageConfig:i,castList:n,castListCount:l,castImageItem:H,castSectionItemList:J}=t;this.$pageConfig.set(i||{}),this.$castList.set(n||[]),this.$castListCount.set(l||0),this.$castImageItem.set(H||{}),this.$castSectionItemList.set(J||[])}),d(1))}action_load(){this.load().pipe(c(this.#t),d(1)).subscribe()}$load_castList_isWait=r(!1);load_castList(){this.$load_castList_isWait.set(!0),this.$castList.set(void 0),this.$castListCount.set(void 0);let e=this.$params();return this.api.post("page/castList/load_castList",e).pipe(c(this.#t),m(({results:t})=>{let{castList:i,castListCount:n}=t;this.$castList.set(i||[]),this.$castListCount.set(n||0),this.$load_castList_isWait.set(!0),this.changeDetectorRef.detectChanges()}),d(1))}action_load_castList(){this.load_castList().pipe(c(this.#t),d(1)).subscribe()}action_remove_cast(e){if(!confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002"))return;let t={cast:g(_({},e),{_:null})};this.api.post("page/castList/remove_cast",t).pipe(c(this.#t),m(()=>{this.$castList.update(i=>i.filter(n=>n.uid!==t.cast.uid))}),d(1)).subscribe()}action_cast_viewFlag(e){e._=g(_({},e._),{isWait:!0});let t={cast:g(_({},e),{viewFlag:!e.viewFlag,_:null})};this.api.post("page/castList/save_cast_viewFlag",t).pipe(c(this.#t)).pipe(m(({results:i})=>{e.viewFlag=!!t.cast.viewFlag,e._=g(_({},e._),{isWait:!1}),this.changeDetectorRef.markForCheck()})).subscribe()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=E({type:a,selectors:[["app-cast-list"]],hostAttrs:[1,"h-100"],decls:2,vars:1,consts:[[1,"card","h-100","user-select-none"],[1,"card-header","rounded-0"],[1,"card-body","p-1","overflow-y-scroll"],[1,"card"],[1,"card-header","p-0","px-1"],[1,"card-body","p-1"],[1,"d-flex","flex-row","flex-wrap"],[1,"input-group","input-group-sm","w-auto"],[1,"input-group-text"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"card","my-1"],[1,"d-flex","flex-wrap","gap-1",3,"nxtSortablejs","config"],[1,"card","m-0","h-100",2,"width","200px"],[1,"card-header","p-1","d-flex","flex-row","justify-content-between","g-1"],[1,"fa","fa-arrows","handle","fa-hover","cursor-move","handle"],[1,"fa","fa-times","text-danger","fa-hover","cursor-pointer",3,"click"],[1,"card-body","p-0"],[1,"p-0"],["routerLink","/castEdit","loading","lazy",1,"w-100","cursor-pointer",3,"src","queryParams"],[1,"px-1",2,"white-space","nowrap","text-overflow","ellipsis","overflow","hidden"],["routerLink","/castEdit",3,"queryParams","textContent"],[1,"card-footer","p-1","text-center","bg-white"],[1,"btn","btn-sm",3,"click","disabled","textContent"]],template:function(t,i){t&1&&$(0,Z,23,3,"div",0)(1,tt,2,0,"div"),t&2&&x(i.$isReady()?0:1)},dependencies:[U,A,j,O,R,z,B],encapsulation:2})};export{D as default};
