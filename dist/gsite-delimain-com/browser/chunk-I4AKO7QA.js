import{a as U,b as z}from"./chunk-B3MW6DDU.js";import{a as pt,b as $e,c as me,d as ut,e as Me,f as R,g as _t,h as ht,i as G,j as ft}from"./chunk-QOPUWJ4Y.js";import{a as mt}from"./chunk-LKU3N2RT.js";import{b as it,c as nt,f as st,h as ot,i as at,j as rt,k as ct,l as lt,n as dt,p as H}from"./chunk-RR3BJK5N.js";import{a as tt}from"./chunk-6NDLDMWB.js";import{A as P,C as de,b as Je,e as Ze,l as Ge,p as Xe,v as et,x as g}from"./chunk-PXBPTLID.js";import{Ab as y,Ba as ve,Bb as Te,Cb as Be,Cc as le,D as he,F as te,Gb as E,J as h,Kb as b,Lb as p,Mb as je,Nb as We,Pb as Oe,Qb as qe,Rb as Pe,S as J,Sa as O,Sb as Ue,T as A,Tb as ze,U as f,Va as l,Wb as V,Xb as ne,Yb as u,Za as be,Zb as we,_ as B,_a as Ae,a as S,b as w,cc as ye,da as c,dc as se,ec as oe,fb as x,fc as He,ga as fe,ib as Fe,ic as q,j as L,ja as C,ka as v,kc as Le,la as j,lc as ae,ma as ge,mc as xe,na as W,nc as Qe,o as De,pa as Ce,pb as Ne,qa as ie,qb as Ve,qc as re,rb as F,sb as N,ua as _,ub as Se,uc as ce,vb as $,vc as Ke,wa as Ie,wb as M,wc as Ye,xb as m,yb as r,yc as Z,z as Y,zb as a}from"./chunk-SHRHIQVS.js";var yt=["dialog"],Lt=["*"],xt=(()=>{class s{constructor(){this._ngbConfig=c(pt),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0,this.role="dialog"}get animation(){return this._animation??this._ngbConfig.animation}set animation(e){this._animation=e}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),$t=["animation","backdropClass"],Mt=(()=>{class s{constructor(){this._nativeElement=c(ve).nativeElement,this._zone=c(ie),this._injector=c(j),this._cdRef=c(Z)}ngOnInit(){be({mixedReadWrite:()=>R(this._zone,this._nativeElement,(e,t)=>{t&&Me(e),e.classList.add("show")},{animation:this.animation,runningTransition:"continue"})},{injector:this._injector})}hide(){return R(this._zone,this._nativeElement,({classList:e})=>e.remove("show"),{animation:this.animation,runningTransition:"stop"})}updateOptions(e){$t.forEach(t=>{me(e[t])&&(this[t]=e[t])}),this._cdRef.markForCheck()}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=x({type:s,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(t,i){t&2&&(ne("modal-backdrop"+(i.backdropClass?" "+i.backdropClass:"")),V("show",!i.animation)("fade",i.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(t,i){},encapsulation:2})}}return s})(),pe=class{update(n){}close(n){}dismiss(n){}},Ee=class{update(n){this._windowCmptRef.instance.updateOptions(n),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._backdropCmptRef.instance.updateOptions(n)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(A(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(A(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(n,e,t,i){this._windowCmptRef=n,this._contentRef=e,this._backdropCmptRef=t,this._beforeDismiss=i,this._closed=new L,this._dismissed=new L,this._hidden=new L,n.instance.dismissEvent.subscribe(o=>{this.dismiss(o)}),this.result=new Promise((o,d)=>{this._resolve=o,this._reject=d}),this.result.then(null,()=>{})}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(!this._beforeDismiss)this._dismiss(n);else{let e=this._beforeDismiss();ut(e)?e.then(t=>{t!==!1&&this._dismiss(n)},()=>{}):e!==!1&&this._dismiss(n)}}_removeModalElements(){let n=this._windowCmptRef.instance.hide(),e=this._backdropCmptRef?this._backdropCmptRef.instance.hide():De(void 0);n.subscribe(()=>{let{nativeElement:t}=this._windowCmptRef.location;t.parentNode.removeChild(t),this._windowCmptRef.destroy(),this._contentRef?.viewRef?.destroy(),this._windowCmptRef=null,this._contentRef=null}),e.subscribe(()=>{if(this._backdropCmptRef){let{nativeElement:t}=this._backdropCmptRef.location;t.parentNode.removeChild(t),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),te(n,e).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}},Re=(function(s){return s[s.BACKDROP_CLICK=0]="BACKDROP_CLICK",s[s.ESC=1]="ESC",s})(Re||{}),Et=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","role","scrollable","size","windowClass","modalDialogClass"],Rt=(()=>{class s{constructor(){this._document=c(ge),this._elRef=c(ve),this._zone=c(ie),this._injector=c(j),this._cdRef=c(Z),this._closed$=new L,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.role="dialog",this.dismissEvent=new Ce,this.shown=new L,this.hidden=new L}get fullscreenClass(){return this.fullscreen===!0?" modal-fullscreen":$e(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(e){this.dismissEvent.emit(e)}ngOnInit(){this._elWithFocus=this._document.activeElement,be({mixedReadWrite:()=>this._show()},{injector:this._injector})}ngOnDestroy(){this._disableEventHandling()}hide(){let{nativeElement:e}=this._elRef,t={animation:this.animation,runningTransition:"stop"},i=R(this._zone,e,()=>e.classList.remove("show"),t),o=R(this._zone,this._dialogEl.nativeElement,()=>{},t),d=te(i,o);return d.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),d}updateOptions(e){Et.forEach(t=>{me(e[t])&&(this[t]=e[t])}),this._cdRef.markForCheck()}_show(){let e={animation:this.animation,runningTransition:"continue"},t=R(this._zone,this._elRef.nativeElement,(o,d)=>{d&&Me(o),o.classList.add("show")},e),i=R(this._zone,this._dialogEl.nativeElement,()=>{},e);te(t,i).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){let{nativeElement:e}=this._elRef;this._zone.runOutsideAngular(()=>{Y(e,"keydown").pipe(A(this._closed$),he(i=>i.key==="Escape")).subscribe(i=>{this.keyboard?requestAnimationFrame(()=>{i.defaultPrevented||this._zone.run(()=>this.dismiss(Re.ESC))}):this.backdrop==="static"&&this._bumpBackdrop()});let t=!1;Y(this._dialogEl.nativeElement,"mousedown").pipe(A(this._closed$),f(()=>t=!1),J(()=>Y(e,"mouseup").pipe(A(this._closed$),h(1))),he(({target:i})=>e===i)).subscribe(()=>{t=!0}),Y(e,"click").pipe(A(this._closed$)).subscribe(({target:i})=>{e===i&&(this.backdrop==="static"?this._bumpBackdrop():this.backdrop===!0&&!t&&this._zone.run(()=>this.dismiss(Re.BACKDROP_CLICK))),t=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){let{nativeElement:e}=this._elRef;if(!e.contains(document.activeElement)){let t=e.querySelector("[ngbAutofocus]"),i=_t(e)[0];(t||i||e).focus()}}_restoreFocus(){let e=this._document.body,t=this._elWithFocus,i;t&&t.focus&&e.contains(t)?i=t:i=e,this._zone.runOutsideAngular(()=>{setTimeout(()=>i.focus()),this._elWithFocus=null})}_bumpBackdrop(){this.backdrop==="static"&&R(this._zone,this._elRef.nativeElement,({classList:e})=>(e.add("modal-static"),()=>e.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275cmp=x({type:s,selectors:[["ngb-modal-window"]],viewQuery:function(t,i){if(t&1&&Oe(yt,7),t&2){let o;qe(o=Pe())&&(i._dialogEl=o.first)}},hostAttrs:["tabindex","-1"],hostVars:8,hostBindings:function(t,i){t&2&&(Ve("aria-modal",!0)("aria-labelledby",i.ariaLabelledBy)("aria-describedby",i.ariaDescribedBy)("role",i.role),ne("modal d-block"+(i.windowClass?" "+i.windowClass:"")),V("fade",i.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",role:"role",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:Lt,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(t,i){t&1&&(je(),Te(0,"div",1,0)(2,"div",2),We(3),Be()()),t&2&&ne("modal-dialog"+(i.size?" modal-"+i.size:"")+(i.centered?" modal-dialog-centered":"")+i.fullscreenClass+(i.scrollable?" modal-dialog-scrollable":"")+(i.modalDialogClass?" "+i.modalDialogClass:""))},styles:[`ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}
`],encapsulation:2})}}return s})(),kt=(()=>{class s{constructor(){this._applicationRef=c(Ne),this._injector=c(j),this._environmentInjector=c(fe),this._document=c(ge),this._scrollBar=c(ft),this._activeWindowCmptHasChanged=new L,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new Ce;let e=c(ie);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){let t=this._windowCmpts[this._windowCmpts.length-1];ht(e,t.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(t.location.nativeElement)}})}_restoreScrollBar(){let e=this._scrollBarRestoreFn;e&&(this._scrollBarRestoreFn=null,e())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(e,t,i){let o=i.container instanceof HTMLElement?i.container:me(i.container)?this._document.querySelector(i.container):this._document.body;if(!o)throw new Error(`The specified modal container "${i.container||"body"}" was not found in the DOM.`);this._hideScrollBar();let d=new pe;e=i.injector||e;let Q=e.get(fe,null)||this._environmentInjector,k=this._getContentRef(e,Q,t,d,i),D=i.backdrop!==!1?this._attachBackdrop(o):void 0,_e=this._attachWindowComponent(o,k.nodes),I=new Ee(_e,k,D,i.beforeDismiss);return this._registerModalRef(I),this._registerWindowCmpt(_e),I.hidden.pipe(h(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),d.close=K=>{I.close(K)},d.dismiss=K=>{I.dismiss(K)},d.update=K=>{I.update(K)},I.update(i),this._modalRefs.length===1&&this._document.body.classList.add("modal-open"),D&&D.instance&&D.changeDetectorRef.detectChanges(),_e.changeDetectorRef.detectChanges(),I}get activeInstances(){return this._activeInstances}dismissAll(e){this._modalRefs.forEach(t=>t.dismiss(e))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(e){let t=le(Mt,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(t.hostView),e.appendChild(t.location.nativeElement),t}_attachWindowComponent(e,t){let i=le(Rt,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:t});return this._applicationRef.attachView(i.hostView),e.appendChild(i.location.nativeElement),i}_getContentRef(e,t,i,o,d){return i?i instanceof Ae?this._createFromTemplateRef(i,o):$e(i)?this._createFromString(i):this._createFromComponent(e,t,i,o,d):new G([])}_createFromTemplateRef(e,t){let i={$implicit:t,close(d){t.close(d)},dismiss(d){t.dismiss(d)}},o=e.createEmbeddedView(i);return this._applicationRef.attachView(o),new G([o.rootNodes],o)}_createFromString(e){let t=this._document.createTextNode(`${e}`);return new G([[t]])}_createFromComponent(e,t,i,o,d){let Q=j.create({providers:[{provide:pe,useValue:o}],parent:e}),k=le(i,{environmentInjector:t,elementInjector:Q}),D=k.location.nativeElement;return d.scrollable&&D.classList.add("component-host-scrollable"),this._applicationRef.attachView(k.hostView),new G([[D]],k.hostView,k)}_setAriaHidden(e){let t=e.parentElement;t&&e!==this._document.body&&(Array.from(t.children).forEach(i=>{i!==e&&i.nodeName!=="SCRIPT"&&(this._ariaHiddenValues.set(i,i.getAttribute("aria-hidden")),i.setAttribute("aria-hidden","true"))}),this._setAriaHidden(t))}_revertAriaHidden(){this._ariaHiddenValues.forEach((e,t)=>{e?t.setAttribute("aria-hidden",e):t.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(e){let t=()=>{let i=this._modalRefs.indexOf(e);i>-1&&(this._modalRefs.splice(i,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(e),this._activeInstances.emit(this._modalRefs),e.result.then(t,t)}_registerWindowCmpt(e){this._windowCmpts.push(e),this._activeWindowCmptHasChanged.next(),e.onDestroy(()=>{let t=this._windowCmpts.indexOf(e);t>-1&&(this._windowCmpts.splice(t,1),this._activeWindowCmptHasChanged.next())})}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),gt=(()=>{class s{constructor(){this._injector=c(j),this._modalStack=c(kt),this._config=c(xt)}open(e,t={}){let i=S(w(S({},this._config),{animation:this._config.animation}),t);return this._modalStack.open(this._injector,e,i)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(e){this._modalStack.dismissAll(e)}hasOpenModals(){return this._modalStack.hasOpenModals()}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var Dt=()=>[],It=(s,n)=>n.castUid;function At(s,n){if(s&1&&(r(0,"div",1),y(1,"img",2),a()),s&2){let e=n.$implicit;l(),m("src",e.castImageSrc,O)}}var ee=class s{#e=c(W);api=c(P);notifyMessage=c(H);$select_castSectionItem=_({});$castSectionList=_([]);castSectionListSortableOptions={handle:".handle",onUpdate:()=>{let n=this.$castSectionList()||[],e={};{let t=Date.now();e.castSectionList=n.map(i=>w(S({},i),{sort:t--})),this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),this.api.post("page/castList/save_castSectionList",e).pipe(g(this.#e),f(()=>{this.$castSectionList.set(e.castSectionList),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),h(1)).subscribe()}}};castSectionListChange=ce();static \u0275fac=function(e){return new(e||s)};static \u0275cmp=x({type:s,selectors:[["app-cast-section-list-sort"]],hostAttrs:[1,"h-100"],outputs:{castSectionListChange:"castSectionListChange"},decls:3,vars:3,consts:[[1,"d-flex","flex-wrap","h-100","overflow-y-scroll",2,"min-height","0",3,"nxtSortablejs","config"],[1,"col-6","handle",2,"cursor","move"],[2,"width","100%",3,"src"]],template:function(e,t){if(e&1&&(r(0,"div",0),$(1,At,2,1,"div",1,It),a()),e&2){let i=t.$castSectionList()||q(2,Dt);m("nxtSortablejs",i)("config",t.castSectionListSortableOptions),l(),M(i)}},dependencies:[z,U],encapsulation:2})};var Ft=()=>[],Nt=(s,n)=>n.castUid;function Vt(s,n){if(s&1){let e=E();r(0,"li",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div"),y(5,"i",13),a(),r(6,"div")(7,"i",6),b("click",function(){let i=C(e).$implicit,o=p();return v(o.action_remove_castSection(i))}),a()()()(),r(8,"div",14)(9,"div",15),y(10,"img",16),a()(),r(11,"div",17),y(12,"div",18),a()()()}if(s&2){let e=n.$implicit;l(10),m("src",e.castImageSrc,O),l(2),m("textContent",e.castName||"\u672A\u5165\u529B")}}var T=class s{#e=c(W);api=c(P);util=c(de);notifyMessage=c(H);modalService=c(gt);$select_castSectionItem=Ke.required({alias:"select_castSectionItem"});$castSectionList=_(void 0);$castSectionMap=re(()=>(this.$castSectionList()||[]).reduce((t,i)=>(t[i.castUid]=i,t),{}));castSectionListSortableOptions={handle:".handle",onUpdate:(n=>{let e={};{let t=Date.now();e.castSectionList=this.$castSectionList()?.map(i=>w(S({},i),{sort:t--}))}this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),this.api.post("page/castList/save_castSectionList",e).pipe(g(this.#e),f(()=>{this.$castSectionList.set(e.castSectionList),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),h(1)).subscribe()})};actionClose=ce();constructor(){Ie(()=>{this.$select_castSectionItem()?.uid&&this.action_load_castSectionList()})}$load_castSectionList_isWait=_(!1);load_castSectionList(){this.$load_castSectionList_isWait.set(!0);let n={query:{itemUid:this.$select_castSectionItem()?.uid}};return this.api.post("page/castList/load_castSectionList",n).pipe(g(this.#e),f(({results:e})=>{this.$castSectionList.set(e?.castSectionList||[]),this.$load_castSectionList_isWait.set(!1)}),h(1))}action_load_castSectionList(){this.load_castSectionList().subscribe()}add_castSection(n){let e={itemUid:this.$select_castSectionItem()?.uid,castUid:n.uid,sort:Date.now(),castName:n.name,castImagePath:n.imagePath,castImageSrc:n.imageSrc,castAge:n.age},t=this.$castSectionList()||[],i=t.find(d=>d.castUid===n.uid);i&&this.util.remove(t,i),t.unshift(e);let o={castSectionList:t};return this.api.post("page/castList/save_castSectionList",o).pipe(g(this.#e),f(console.log),h(1))}action_remove_castSection(n){if(!confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002"))return;let e={castSection:w(S({},n),{_:null})};this.notifyMessage.show("\u524A\u9664\u4E2D..."),this.api.post("page/castList/remove_castSection",e).pipe(g(this.#e),f(()=>{this.$castSectionList.update(t=>t.filter(i=>i.castUid!==n.castUid)),this.notifyMessage.hide("\u524A\u9664\u3057\u307E\u3057\u305F")}),h(1)).subscribe()}action_open_castSectionListSort(){let n=this.modalService.open(ee,{size:"sm",scrollable:!0,backdropClass:"ngb-modal-backdrop",windowClass:"ngb-modal-window"});{let e=n.componentInstance;e.$castSectionList=this.$castSectionList,e.$select_castSectionItem.set(this.$select_castSectionItem())}}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=x({type:s,selectors:[["app-cast-section-list"]],inputs:{$select_castSectionItem:[1,"select_castSectionItem","$select_castSectionItem"]},outputs:{actionClose:"actionClose"},decls:13,vars:4,consts:[[1,"card","h-100","w-100","user-select-none","rounded-0"],[1,"card-header","p-0"],[1,"d-flex","justify-content-between","p-1"],[1,"d-flex","gap-1"],[3,"textContent"],["href","javascript:void false;",1,"small","mt-auto",3,"click"],[1,"fa","fa-times","text-danger","fa-hover","cursor-pointer",3,"click"],[1,"card-body","overflow-y-scroll","p-1"],[1,"list-group","cast-section-list",3,"config","nxtSortablejs"],[1,"list-group-item","p-0","my-1","border-0"],[1,"card"],[1,"card-header","m-0","p-1"],[1,"d-flex","flex-row","justify-content-between","px-1"],[1,"fa","fa-arrows","handle","fa-hover","cursor-move"],[1,"card-body","p-0"],[1,"text-center"],[1,"w-100",3,"src"],[1,"card-footer","p-1"],[2,"white-space","nowrap","text-overflow","ellipsis","overflow","hidden",3,"textContent"]],template:function(e,t){if(e&1){let i=E();r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),y(4,"span",4),r(5,"a",5),b("click",function(){return C(i),v(t.action_open_castSectionListSort())}),u(6," \u4E26\u3079\u66FF\u3048 "),a()(),r(7,"div")(8,"i",6),b("click",function(){return C(i),v(t.actionClose.emit())}),a()()()(),r(9,"div",7)(10,"ul",8),$(11,Vt,13,2,"li",9,Nt),a()()()}if(e&2){let i;l(4),m("textContent",(i=t.$select_castSectionItem())==null?null:i.label);let o=t.$castSectionList()||q(3,Ft);l(6),m("config",t.castSectionListSortableOptions)("nxtSortablejs",o),l(),M(o)}},dependencies:[z,U],encapsulation:2})};var Tt=s=>`[Repeat] repeat requires an positive integer but "${s}" is passed in`,Bt=s=>`[Repeat] repeat startAt requires an integer but "${s}" is passed in`,bt=(()=>{class s{transform(e,t=0){if(Number.isNaN(e)||!Number.isInteger(e)||e<0)throw new Error(Tt(e));if(Number.isNaN(t)||!Number.isInteger(t))throw new Error(Bt(t));return Array.from({length:e},(i,o)=>o+t)}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275pipe=Fe({name:"repeat",type:s,pure:!0})}}return s})();var ue=class s{transparent="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";static \u0275fac=function(e){return new(e||s)};static \u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})};var jt=()=>[1,5,10,30,50,100,500,100],St=(s,n)=>({domain:s,uid:n}),wt=(s,n)=>n.uid;function Wt(s,n){if(s&1&&(y(0,"option",15),ae(1,"number")),s&2){let e=n.$implicit;m("ngValue",e)("textContent",xe(1,2,e))}}function Ot(s,n){if(s&1&&(r(0,"option",14),u(1),a()),s&2){let e=n.$implicit,t=p(2);m("ngValue",He("col-",e)),l(),we("",t.Math.floor(e/12*100),"%")}}function qt(s,n){if(s&1){let e=E();r(0,"button",26),b("click",function(){let i=C(e).$implicit,o=p(2);return v(o.action_select_castSelectionItem(i))}),a()}if(s&2){let e=n.$implicit;p();let t=oe(56);V("btn-light",e.uid!==t)("btn-success",e.uid===t),m("textContent",e.label)}}function Pt(s,n){if(s&1&&(y(0,"span",23),ae(1,"number")),s&2){p();let e=oe(68);m("textContent",xe(1,1,e))}}function Ut(s,n){s&1&&y(0,"img",35),s&2&&m("src",n,O)}function zt(s,n){if(s&1){let e=E();r(0,"div",40)(1,"button",41),b("click",function(){C(e);let i=p().$implicit,o=p(3);return v(o.add_castSection(i))}),u(2),a()()}s&2&&(l(2),we(" ",n.label,"\u3092\u8FFD\u52A0 "))}function Ht(s,n){if(s&1){let e=E();r(0,"div")(1,"div",28)(2,"div",29),y(3,"i",30),r(4,"i",31),b("click",function(){let i=C(e).$implicit,o=p(3);return v(o.action_remove_cast(i))}),a()(),r(5,"div",32)(6,"div",33)(7,"div",34),F(8,Ut,1,1,"img",35),a(),r(9,"div",36),y(10,"a",37),a()()(),r(11,"div",38)(12,"div",5)(13,"div")(14,"button",39),b("click",function(){let i=C(e).$implicit,o=p(3);return v(o.action_cast_viewFlag(i))}),a()(),F(15,zt,3,1,"div",40),a()()()()}if(s&2){let e,t,i=n.$implicit;p(2);let o=oe(55),d=p();l(7),m("queryParams",Le(13,St,d.navigation.$domain(),i.uid)),l(),N((e=i.imageSrc)?8:-1,e),l(2),m("queryParams",Le(16,St,d.navigation.$domain(),i.uid))("textContent",i.name||"\u672A\u5165\u529B"),l(4),V("btn-success",i.viewFlag)("border",!i.viewFlag)("disabled",i._==null?null:i._.isWait),m("disabled",i._==null?null:i._.isWait)("textContent",i.viewFlag?"\u516C\u958B\u4E2D":"\u975E\u516C\u958B"),l(),N((t=o)?15:-1,t)}}function Qt(s,n){if(s&1&&(r(0,"div",8)(1,"div",27),$(2,Ht,16,19,"div",null,wt),a()()),s&2){let e=n,t=p(2);l(),m("nxtSortablejs",e)("config",t.castListSortableOptions),l(),M(e)}}function Kt(s,n){if(s&1){let e=E();r(0,"div",25)(1,"app-cast-section-list",42),b("actionClose",function(){C(e);let i=p(2);return v(i.$select_castSectionItem.set(void 0))}),a()()}if(s&2){let e=p(2);m("ngClass",e.$viewSettings_castSectionClass()),l(),m("select_castSectionItem",n)}}function Yt(s,n){if(s&1){let e=E();r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"strong"),u(5,"\u30AD\u30E3\u30B9\u30C8\u4E00\u89A7"),a()()(),r(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"span"),u(11,"\u691C\u7D22"),a()(),r(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),u(16," \u30AD\u30E3\u30B9\u30C8\u540D "),a(),r(17,"input",12),b("ngModelChange",function(i){C(e);let o=p();return o.$q_castName.set(i),v(o.action_load_castList())}),a()(),r(18,"div",10)(19,"div",11),u(20,"\u516C\u958B\u72B6\u614B"),a(),r(21,"select",13),b("ngModelChange",function(i){C(e);let o=p();return o.$q_viewFlag.set(i),v(o.action_load_castList())}),r(22,"option",14),u(23,"\u5168\u3066"),a(),r(24,"option",14),u(25,"\u8868\u793A\u4E2D"),a(),r(26,"option",14),u(27,"\u975E\u8868\u793A"),a()()(),r(28,"div",10)(29,"div",11),u(30,"\u8868\u793A\u4EF6\u6570"),a(),r(31,"select",13),b("ngModelChange",function(i){C(e);let o=p();return o.$q_limit.set(i),v(o.action_load_castList())}),$(32,Wt,2,4,"option",15,Se),a()(),r(34,"div",10)(35,"div",11),u(36,"\u30DA\u30FC\u30B8"),a(),r(37,"input",16),b("ngModelChange",function(i){C(e);let o=p();return o.$q_page.set(i),v(o.action_load_castList())})("wheel",function(){C(e);let i=p();return v(i.util.noop())}),a()()()()(),r(38,"div",6)(39,"div",7),u(40,"\u8A2D\u5B9A"),a(),r(41,"div",8)(42,"div",17)(43,"div",10)(44,"div",11),u(45,"\u30BB\u30AF\u30B7\u30E7\u30F3(\u5E45)"),a(),r(46,"select",18),b("ngModelChange",function(i){C(e);let o=p();return v(o.$viewSettings_castSectionClass.set(i))}),$(47,Ot,2,3,"option",14,Se),ae(49,"repeat"),a()()()()(),r(50,"div",6)(51,"div",7)(52,"span"),u(53,"\u64CD\u4F5C"),a()(),r(54,"div",8),ye(55)(56),r(57,"div",19)(58,"span",20),u(59,"\u30BB\u30AF\u30B7\u30E7\u30F3"),a(),$(60,qt,1,5,"button",21,wt),a()()(),r(62,"div",6)(63,"div",7)(64,"div",22)(65,"div")(66,"span"),u(67,"\u4E00\u89A7"),a(),ye(68),F(69,Pt,2,3,"span",23),a(),r(70,"div")(71,"i",24),b("click",function(){C(e);let i=p();return v(i.action_load_castList())}),a()()()(),F(72,Qt,4,2,"div",8),a()()()(),F(73,Kt,2,2,"div",25),a()}if(s&2){let e,t,i=p();l(17),m("ngModel",i.$q_castName()),l(4),m("ngModel",i.$q_viewFlag()),l(),m("ngValue",void 0),l(2),m("ngValue",!0),l(2),m("ngValue",!1),l(5),m("ngModel",i.$q_limit()),l(),M(q(20,jt)),l(5),m("min",1)("ngModel",i.$q_page()),l(9),m("ngModel",i.$viewSettings_castSectionClass()),l(),M(Qe(49,14,6,1)),l(8);let o=se(i.$select_castSectionItem());l(),se(o==null?null:o.uid),l(4),M(i.$castSectionItemList()),l(8);let d=se(i.$castListCount());l(),N(i.util.isNumber(d)?69:-1),l(2),V("fa-spin",i.$load_castList_isWait()),l(),N((e=i.$castList())?72:-1,e),l(),N((t=i.$select_castSectionItem())?73:-1,t)}}function Jt(s,n){s&1&&(r(0,"div"),u(1,"loading..."),a())}var ke=class s{#e=c(W);util=c(de);navigation=c(mt);api=c(P);activatedRoute=c(Ge);notifyMessage=c(H);changeDetectorRef=c(Z);noimage=c(ue);Math=Math;$viewSettings_castSectionClass=et("CastListComponent.$viewSettings_castSectionClass",{defaultValue:"col-2"});castListSortableOptions={handle:".handle",onUpdate:()=>{this.notifyMessage.show("\u4FDD\u5B58\u4E2D...");let n={};{let e=Date.now(),t=this.$castList()||[];n.castList=t.map(i=>w(S({},i),{sort:e--}))}this.api.post("page/castList/save_castList_sort",n).pipe(g(this.#e),f(()=>{this.$castList.set(n.castList),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),h(1)).subscribe()}};$isReady=_(!1);$queryParams=tt();$q_castName=_("");$q_viewFlag=_(void 0);$q_limit=_(100);$q_page=_(1);$params=re(()=>{let n={query:{}};return n.query.name=this.$q_castName(),n.query.viewFlag=this.$q_viewFlag(),n.query.limit=this.$q_limit(),n.query.offset=(this.$q_page()-1)*this.$q_limit(),n});$pageConfig=_(void 0);$castList=_(void 0);$castListCount=_(void 0);$castImageItem=_(void 0);$castSectionItemList=_(void 0);action_select_castSelectionItem(n){let e=this.$select_castSectionItem();this.$select_castSectionItem.set(e?.uid===n.uid?void 0:n)}$select_castSectionItem=_(void 0);$castSectionListComponent=Ye(T);constructor(){this.activatedRoute.queryParams.pipe(g(this.#e),f(()=>this.$isReady.set(!1)),J(()=>this.load()),f(()=>this.$isReady.set(!0))).subscribe()}load(){this.$castList.set(void 0),this.$castListCount.set(void 0);let n=this.$params();return this.api.post("page/castList/load",n).pipe(g(this.#e),f(({results:e})=>{let{pageConfig:t,castList:i,castListCount:o,castImageItem:d,castSectionItemList:Q}=e;this.$pageConfig.set(t||{}),this.$castList.set(i||[]),this.$castListCount.set(o||0),this.$castImageItem.set(d||{}),this.$castSectionItemList.set(Q||[])}),h(1))}action_load(){this.load().pipe(g(this.#e),h(1)).subscribe()}$load_castList_isWait=_(!1);load_castList(){this.$load_castList_isWait.set(!0),this.$castList.set(void 0),this.$castListCount.set(void 0);let n=this.$params();return this.api.post("page/castList/load_castList",n).pipe(g(this.#e),f(({results:e})=>{this.$castList.set(e.castList||[]),this.$castListCount.set(e.castListCount||0),this.$load_castList_isWait.set(!1)}),h(1))}load_castList$=(()=>{let n=new L;return n.pipe(g(this.#e),J(()=>this.load_castList())).subscribe(),n})();action_load_castList(){this.load_castList$.next(null)}remove_cast(n){let e={cast:w(S({},n),{_:null})};return this.api.post("page/castList/remove_cast",e).pipe(g(this.#e),f(()=>{this.$castList.update(t=>t.filter(i=>i.uid!==e.cast.uid)),this.$castListCount.update(t=>t-1)}),h(1))}action_remove_cast(n){confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002")&&this.remove_cast(n).pipe(g(this.#e),h(1)).subscribe()}action_cast_viewFlag(n){this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),n._=w(S({},n._),{isWait:!0});let e={cast:w(S({},n),{viewFlag:!n.viewFlag,_:null})};this.api.post("page/castList/save_cast_viewFlag",e).pipe(g(this.#e)).pipe(f(({results:t})=>{n.viewFlag=!!e.cast.viewFlag,n._=w(S({},n._),{isWait:!1}),this.changeDetectorRef.markForCheck(),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")})).subscribe()}add_castSection(n){this.$castSectionListComponent()?.add_castSection(n)?.pipe(g(this.#e),f(console.log),h(1))?.subscribe()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=x({type:s,selectors:[["app-cast-list"]],viewQuery:function(e,t){e&1&&Ue(t.$castSectionListComponent,T,5),e&2&&ze()},hostAttrs:[1,"h-100"],decls:2,vars:1,consts:[[1,"d-flex","flex-row","h-100"],[1,"card","w-100","h-100","user-select-none","p-0","m-0","rounded-0"],[1,"card-header","rounded-0","p-0"],[1,"p-1"],[1,"card-body","p-1","m-0","overflow-y-scroll"],[1,"d-flex","flex-column","gap-1"],[1,"card"],[1,"card-header","p-0","px-1"],[1,"card-body","p-1"],[1,"d-flex","flex-row","flex-wrap","gap-1"],[1,"input-group","input-group-sm","w-auto"],[1,"input-group-text"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue","textContent"],["type","number",1,"form-control","form-control-sm",2,"width","4rem",3,"ngModelChange","wheel","min","ngModel"],[1,"d-flex","flex-row","flex-wrap"],[1,"form-select","form-select-sm",2,"width","6rem",3,"ngModelChange","ngModel"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-secondary-subtle"],[1,"btn","btn-sm","border",3,"btn-light","btn-success","textContent"],[1,"d-flex","flex-row","justify-content-between","px-1"],[1,"mx-1","label-count",3,"textContent"],[1,"fa","fa-refresh","fa-hover","cursor-pointer",3,"click"],[1,"h-100","overflow-y-hidden",3,"ngClass"],[1,"btn","btn-sm","border",3,"click","textContent"],[1,"d-flex","flex-wrap","gap-1","col",3,"nxtSortablejs","config"],[1,"card","m-0","h-100",2,"width","200px"],[1,"card-header","p-1","d-flex","flex-row","justify-content-between","g-1"],[1,"fa","fa-arrows","handle","fa-hover","cursor-move","handle"],[1,"fa","fa-times","text-danger","fa-hover","cursor-pointer",3,"click"],[1,"card-body","p-0","h-100"],[1,"d-flex","flex-column","justify-content-between","h-100"],["routerLink","/castEdit",1,"p-0","cursor-pointer","h-100",3,"queryParams"],["loading","lazy",1,"w-100",3,"src"],[1,"px-1","py-1",2,"white-space","nowrap","text-overflow","ellipsis","overflow","hidden"],["routerLink","/castEdit",3,"queryParams","textContent"],[1,"card-footer","p-1","text-center","bg-white"],[1,"btn","btn-sm",3,"click","disabled","textContent"],[1,"text-center"],[1,"btn","border","btn-sm",3,"click"],[3,"actionClose","select_castSectionItem"]],template:function(e,t){e&1&&F(0,Yt,74,21,"div",0)(1,Jt,2,0,"div"),e&2&&N(t.$isReady()?0:1)},dependencies:[dt,rt,ct,it,ot,at,nt,lt,st,Xe,z,U,T,Je,Ze,bt],encapsulation:2})};export{ke as default};
