import{a as ce}from"./chunk-ZN2RQVFS.js";import{a as ae,b as oe,c as le,d as re,e as se,f as de}from"./chunk-SSIGKLEV.js";import{a as J}from"./chunk-GUTABKTZ.js";import{b as X,c as Z,f as ee,n as te,o as ie,p as ne}from"./chunk-MZI3TSC7.js";import{a as G}from"./chunk-AK7IFNAC.js";import{A as z,C as K,l as H,x as b}from"./chunk-QS74EYGS.js";import{$b as v,Eb as M,I as x,Ib as u,Jb as d,Ob as U,Pb as q,Qa as R,Qb as N,R as D,Sb as h,T as C,Ta as s,Tb as r,Zb as j,_b as F,a as V,ba as g,db as A,dc as k,ha as m,ia as _,ib as I,j as W,la as T,lc as Q,pb as S,qb as $,rb as B,rc as Y,sa as f,tb as P,ub as O,vb as p,wb as a,xb as n,yb as E}from"./chunk-J3CZU5IE.js";var _e=["el_file"],me=()=>({});function ue(l,o){l&1&&E(0,"i",32)}function pe(l,o){l&1&&E(0,"img",34),l&2&&p("src",o,R)}function ve(l,o){if(l&1){let i=M();a(0,"div",17)(1,"table",18)(2,"tr")(3,"th")(4,"div",19)(5,"span"),r(6,"\u516C\u958B\u60C5\u5831"),n(),a(7,"span",20),r(8,"\u5171\u901A"),n()()(),a(9,"td")(10,"div")(11,"button",21),u("click",function(){m(i),d();let t=v(0);return _(t.viewFlag=!t.viewFlag)}),r(12," \u8868\u793A\u4E2D "),n()()()(),a(13,"tr")(14,"th")(15,"div",19)(16,"span"),r(17,"\u767B\u9332\u65E5\u6642"),n(),a(18,"span",20),r(19,"\u5171\u901A"),n()()(),a(20,"td")(21,"div",22)(22,"div",23)(23,"input",24),u("ngModelChange",function(t){m(i),d();let c=v(0),y=d(2);return _(c.regDatetime=y.util.m(t).toDate().getTime())}),n()()()()(),a(24,"tr")(25,"th"),r(26,"\u30BF\u30A4\u30C8\u30EB"),n(),a(27,"td")(28,"div",23)(29,"input",25),u("ngModelChange",function(t){m(i),d();let c=v(1);return _(c.title=t)}),n()()()(),a(30,"tr")(31,"th"),r(32,"\u672C\u6587"),n(),a(33,"td")(34,"div",26)(35,"app-el-ckeditor",27),u("valueChange",function(t){m(i),d();let c=v(1);return _(c.body=t)}),n()()()(),a(36,"tr")(37,"th")(38,"div",19)(39,"span"),r(40,"\u753B\u50CF"),n(),a(41,"span",20),r(42,"\u5171\u901A"),n()()(),a(43,"td")(44,"div",28)(45,"div")(46,"input",29,1),u("change",function(){m(i);let t=d(3);return _(t.action_upload_image())}),n(),a(48,"i",30),u("click",function(){m(i);let t=N(47);return _(t.click())}),n(),a(49,"i",31),u("click",function(){m(i),d();let t=v(0);return t.imagePath=void 0,_(t.imageSrc=void 0)}),n(),S(50,ue,1,0,"i",32),n(),a(51,"div",33),S(52,pe,1,1,"img",34),n()()()(),a(53,"tr")(54,"th")(55,"div",19)(56,"span"),r(57,"\u516C\u958B\u60C5\u5831"),n(),a(58,"span",20),r(59,"\u5171\u901A"),n()()(),a(60,"td")(61,"div")(62,"button",21),u("click",function(){m(i),d();let t=v(0);return _(t.viewFlag=!t.viewFlag)}),r(63," \u8868\u793A\u4E2D "),n()()()()()()}if(l&2){let i;d();let e=v(0),t=v(1),c=d(2);s(11),h("btn-success",e.viewFlag),s(12),p("ngModel",c.util.m(e.regDatetime).format("YYYY-MM-DD HH:mm")),s(6),p("ngModel",(t==null?null:t.title)||""),s(6),p("value",t.body),s(15),$(c.$upload_image_isWait()?50:-1),s(2),$((i=e==null?null:e.imageSrc)?52:-1,i),s(10),h("btn-success",e.viewFlag)}}function ge(l,o){if(l&1&&(j(0)(1),a(2,"li",7),E(3,"button",15),I(4,ve,64,9,"ng-template",16),n()),l&2){let i,e=o.$implicit,t=d(2),c=e.lang;F(t.$event()||k(3,me)),s(),F(((i=t.$eventDetailMap())==null?null:i[c])||k(4,me)),s(2),p("textContent",e.label)}}function fe(l,o){if(l&1){let i=M();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"strong"),r(4,"\u30A4\u30D9\u30F3\u30C8\u7DE8\u96C6"),n()(),a(5,"div",5)(6,"ul",6,0),P(8,ge,5,5,"li",7,B),n()()(),a(10,"div",8)(11,"div",9)(12,"div",10)(13,"span"),r(14,"\u7DE8\u96C6"),n()(),a(15,"div",11)(16,"div",12)(17,"button",13),u("click",function(){m(i);let t=d();return _(t.action_save())}),r(18," \u4FDD\u5B58 "),n()(),E(19,"div",14),a(20,"div",12)(21,"button",13),u("click",function(){m(i);let t=d();return _(t.action_save())}),r(22," \u4FDD\u5B58 "),n()()()()()()}if(l&2){let i=N(7),e=d();s(6),p("animation",!1),s(2),O(e.siteInfo.$site_langList()),s(9),h("disabled",e.$save_isWait()),p("disabled",e.$save_isWait()),s(2),p("ngbNavOutlet",i),s(2),h("disabled",e.$save_isWait()),p("disabled",e.$save_isWait())}}function be(l,o){l&1&&(a(0,"div"),r(1,"loading..."),n())}var L=class l{#e=g(T);util=g(K);api=g(z);imageUtil=g(de);notifyMessage=g(ne);activatedRoute=g(H);siteInfo=g(J);$isReady=f(!1);$q_uid=G("uid");$results=f({});$event=f(void 0);$eventDetailList=f(void 0);$eventDetailMap=Q(()=>{let i=(this.$eventDetailList()||[]).reduce((e,t)=>(e[t.lang]=t,e),{});return this.siteInfo.$site_langList().forEach(e=>{let t=e.lang;i[t]||(i[t]={lang:t})}),i});$el_file=Y("el_file");constructor(){this.activatedRoute.queryParams.pipe(b(this.#e),C(()=>this.$isReady.set(!1)),D(()=>this.load()),C(()=>this.$isReady.set(!0))).subscribe()}load(){let o={query:{uid:this.$q_uid()}};return this.api.post("page/eventEdit/load",o).pipe(b(this.#e),C(({results:i})=>{{let e=Date.now();this.$event.set(i.event||{uid:this.$q_uid(),regDatetime:e,viewDatetime:e,viewFlag:!0,sort:e})}this.$eventDetailList.set(i.eventDetailList||[]),this.$results.set(i)}),x(1))}$upload_image_isWait=f(!1);upload_image(){this.$upload_image_isWait.set(!0);let o=this.$event(),e=(this.$el_file()?.nativeElement).files?.[0],c={path:`event/${o?.uid}/${this.util.ulid()}.png`,file:e};return this.imageUtil.upload(c).pipe(b(this.#e),C(({results:y})=>{this.$event.update(w=>(w.imagePath=y.path,w.imageSrc=y.src,V({},w))),this.$upload_image_isWait.set(!1)}),x(1))}action_upload_image(){this.upload_image().pipe(b(this.#e),x(1)).subscribe()}$save_isWait=f(!1);save(){let o={event:this.$event(),eventDetailList:Object.values(this.$eventDetailMap())};return this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),this.$save_isWait.set(!0),this.api.post("page/eventEdit/save",o).pipe(b(this.#e),C(()=>{this.$save_isWait.set(!1),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),x(1))}save$=(()=>{let o=new W;return o.pipe(b(this.#e),D(()=>this.save())).subscribe(),o})();action_save(){this.save$.next(null)}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=A({type:l,selectors:[["app-event-edit"]],viewQuery:function(i,e){i&1&&U(e.$el_file,_e,5),i&2&&q()},decls:2,vars:1,consts:[["nav","ngbNav"],["el_file",""],[1,"card","h-100","m-0","rounded-0","user-select-none"],[1,"card-header","p-0","rounded-0"],[1,"p-1"],[1,"bg-white"],["ngbNav","",1,"nav-tabs","rounded-0",3,"animation"],["ngbNavItem","",1,"rounded-0"],[1,"card-body","m-0","p-1","h-100","overflow-y-scroll"],[1,"card"],[1,"card-header","p-1"],[1,"card-body","p-1"],[1,"m-1"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[3,"ngbNavOutlet"],["ngbNavLink","",1,"btn-sm","btn","p-1","rounded-0",2,"width","5rem",3,"textContent"],["ngbNavContent",""],[1,""],[1,"table","table-bordered","table-fixed","infoEdit_table"],[1,"d-flex","flex-row","gap-1"],[1,"badge","text-bg-secondary","rounded-pill"],[1,"btn","btn-sm","border",3,"click"],[1,"d-flex","flex-row"],[1,"input-group","input-group-sm","w-auto"],["type","datetime-local",1,"form-control","form-control-sm",2,"width","10rem",3,"ngModelChange","ngModel"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"p-2"],[3,"valueChange","value"],[1,"d-flex","flex-column","gap-1"],["type","file",2,"display","none",3,"change"],[1,"fa","fa-picture-o","fa-hover","cursor-pointer",3,"click"],[1,"fa","fa-times","text-danger","cursor-pointer","fa-hover","mx-3",3,"click"],[1,"fa","fa-refresh","mx-1","fa-spin"],[2,"width","300px"],[1,"w-100",3,"src"]],template:function(i,e){i&1&&S(0,fe,23,8,"div",2)(1,be,2,0,"div"),i&2&&$(e.$isReady()?0:1)},dependencies:[ce,le,ae,oe,re,ie,X,Z,se,te,ee],encapsulation:2})};export{L as default};
