import{a as P,b as U}from"./chunk-HZ5RSWXO.js";import{a as wt}from"./chunk-XLHTXXLE.js";import{b as ft,c as vt,f as St,h as bt,i as ht,j as xt,k as Lt,l as yt,n as $t,p as j}from"./chunk-MZI3TSC7.js";import{a as gt}from"./chunk-AK7IFNAC.js";import{A as B,C as R,b as pt,e as mt,l as ut,p as _t,v as Ct,x as C}from"./chunk-QS74EYGS.js";import{$b as q,Eb as L,I as S,Ib as g,Jb as d,Ob as nt,Pb as at,Qa as D,R as Q,Sb as V,T as f,Ta as c,Tb as p,Ub as Y,Y as tt,Zb as J,_b as F,a as h,ac as ot,b as x,ba as v,db as N,dc as k,fc as K,gb as it,gc as T,ha as m,hc as G,ia as u,ic as st,j as Z,la as I,lc as W,pb as $,pc as rt,qb as w,qc as ct,rc as lt,sa as _,sb as z,tb as M,tc as dt,ua as et,ub as A,vb as l,wb as s,xb as o,yb as b}from"./chunk-J3CZU5IE.js";var Vt=()=>[],Ft=(a,e)=>e.castUid;function qt(a,e){if(a&1){let t=L();s(0,"li",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"div"),b(5,"i",11),o(),s(6,"div")(7,"i",4),g("click",function(){let i=m(t).$implicit,r=d();return u(r.action_remove_castSection(i))}),o()()()(),s(8,"div",12)(9,"div",13),b(10,"img",14),o()(),s(11,"div",15),b(12,"div",16),o()()()}if(a&2){let t=e.$implicit;c(10),l("src",t.castImageSrc,D),c(2),l("textContent",t.castName||"\u672A\u5165\u529B")}}var E=class a{#t=v(I);api=v(B);util=v(R);notifyMessage=v(j);$select_castSectionItem=ct.required({alias:"select_castSectionItem"});$castSectionList=_(void 0);$castSectionMap=W(()=>(this.$castSectionList()||[]).reduce((n,i)=>(n[i.castUid]=i,n),{}));castSectionListSortableOptions={handle:".handle",onUpdate:(e=>{let t={};{let n=Date.now();t.castSectionList=this.$castSectionList()?.map(i=>x(h({},i),{sort:n--}))}this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),this.api.post("page/castList/save_castSectionList",t).pipe(C(this.#t),f(()=>{this.$castSectionList.set(t.castSectionList),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),S(1)).subscribe()})};actionClose=rt();constructor(){et(()=>{this.$select_castSectionItem()?.uid&&this.action_load_castSectionList()})}$load_castSectionList_isWait=_(!1);load_castSectionList(){this.$load_castSectionList_isWait.set(!0);let e={query:{itemUid:this.$select_castSectionItem()?.uid}};return this.api.post("page/castList/load_castSectionList",e).pipe(C(this.#t),f(({results:t})=>{this.$castSectionList.set(t?.castSectionList||[]),this.$load_castSectionList_isWait.set(!1)}),S(1))}action_load_castSectionList(){this.load_castSectionList().subscribe()}add_castSection(e){let t={itemUid:this.$select_castSectionItem()?.uid,castUid:e.uid,sort:Date.now(),castName:e.name,castImagePath:e.imagePath,castImageSrc:e.imageSrc,castAge:e.age},n=this.$castSectionList()||[],i=n.find(y=>y.castUid===e.uid);i&&this.util.remove(n,i),n.unshift(t);let r={castSectionList:n};return this.api.post("page/castList/save_castSectionList",r).pipe(C(this.#t),f(console.log),S(1))}action_remove_castSection(e){if(!confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002"))return;let t={castSection:x(h({},e),{_:null})};this.notifyMessage.show("\u524A\u9664\u4E2D..."),this.api.post("page/castList/remove_castSection",t).pipe(C(this.#t),f(()=>{this.$castSectionList.update(n=>n.filter(i=>i.castUid!==e.castUid)),this.notifyMessage.hide("\u524A\u9664\u3057\u307E\u3057\u305F")}),S(1)).subscribe()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=N({type:a,selectors:[["app-cast-section-list"]],inputs:{$select_castSectionItem:[1,"select_castSectionItem","$select_castSectionItem"]},outputs:{actionClose:"actionClose"},decls:10,vars:4,consts:[[1,"card","h-100","w-100","user-select-none","rounded-0"],[1,"card-header","p-0"],[1,"d-flex","justify-content-between","p-1"],[3,"textContent"],[1,"fa","fa-times","text-danger","fa-hover","cursor-pointer",3,"click"],[1,"card-body","overflow-y-scroll","p-1"],[1,"list-group","cast-section-list",3,"config","nxtSortablejs"],[1,"list-group-item","p-0","my-1","border-0"],[1,"card"],[1,"card-header","m-0","p-1"],[1,"d-flex","flex-row","justify-content-between","px-1"],[1,"fa","fa-arrows","handle","fa-hover","cursor-move"],[1,"card-body","p-0"],[1,"text-center"],[1,"w-100",3,"src"],[1,"card-footer","p-1"],[2,"white-space","nowrap","text-overflow","ellipsis","overflow","hidden",3,"textContent"]],template:function(t,n){if(t&1){let i=L();s(0,"div",0)(1,"div",1)(2,"div",2),b(3,"div",3),s(4,"div")(5,"i",4),g("click",function(){return m(i),u(n.actionClose.emit())}),o()()()(),s(6,"div",5)(7,"ul",6),M(8,qt,13,2,"li",7,Ft),o()()()}if(t&2){let i;c(3),l("textContent",(i=n.$select_castSectionItem())==null?null:i.label);let r=n.$castSectionList()||k(3,Vt);c(4),l("config",n.castSectionListSortableOptions)("nxtSortablejs",r),c(),A(r)}},dependencies:[U,P],encapsulation:2})};var kt=a=>`[Repeat] repeat requires an positive integer but "${a}" is passed in`,Tt=a=>`[Repeat] repeat startAt requires an integer but "${a}" is passed in`,Mt=(()=>{class a{transform(t,n=0){if(Number.isNaN(t)||!Number.isInteger(t)||t<0)throw new Error(kt(t));if(Number.isNaN(n)||!Number.isInteger(n))throw new Error(Tt(n));return Array.from({length:t},(i,r)=>r+n)}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275pipe=it({name:"repeat",type:a,pure:!0})}}return a})();var O=class a{transparent="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";static \u0275fac=function(t){return new(t||a)};static \u0275prov=tt({token:a,factory:a.\u0275fac,providedIn:"root"})};var Wt=()=>[1,5,10,30,50,100,500,100],At=(a,e)=>({domain:a,uid:e}),Et=(a,e)=>e.uid;function Bt(a,e){if(a&1&&(b(0,"option",15),T(1,"number")),a&2){let t=e.$implicit;l("ngValue",t)("textContent",G(1,2,t))}}function Rt(a,e){if(a&1&&(s(0,"option",14),p(1),o()),a&2){let t=e.$implicit,n=d(2);l("ngValue",ot("col-",t)),c(),Y("",n.Math.floor(t/12*100),"%")}}function Pt(a,e){if(a&1){let t=L();s(0,"button",25),g("click",function(){let i=m(t).$implicit,r=d(2);return u(r.action_select_castSelectionItem(i))}),o()}if(a&2){let t=e.$implicit;d();let n=q(55);V("btn-light",t.uid!==n)("btn-success",t.uid===n),l("textContent",t.label)}}function Ut(a,e){if(a&1&&(b(0,"span",22),T(1,"number")),a&2){d();let t=q(67);l("textContent",G(1,1,t))}}function jt(a,e){a&1&&b(0,"img",34),a&2&&l("src",e,D)}function Ot(a,e){if(a&1){let t=L();s(0,"div",39)(1,"button",40),g("click",function(){m(t);let i=d().$implicit,r=d(3);return u(r.add_castSection(i))}),p(2),o()()}a&2&&(c(2),Y(" ",e.label,"\u3092\u8FFD\u52A0 "))}function Qt(a,e){if(a&1){let t=L();s(0,"div")(1,"div",27)(2,"div",28),b(3,"i",29),s(4,"i",30),g("click",function(){let i=m(t).$implicit,r=d(3);return u(r.action_remove_cast(i))}),o()(),s(5,"div",31)(6,"div",32)(7,"div",33),$(8,jt,1,1,"img",34),o(),s(9,"div",35),b(10,"a",36),o()()(),s(11,"div",37)(12,"div",5)(13,"div")(14,"button",38),g("click",function(){let i=m(t).$implicit,r=d(3);return u(r.action_cast_viewFlag(i))}),o()(),$(15,Ot,3,1,"div",39),o()()()()}if(a&2){let t,n,i=e.$implicit;d(2);let r=q(54),y=d();c(7),l("queryParams",K(13,At,y.navigation.$domain(),i.uid)),c(),w((t=i.imageSrc)?8:-1,t),c(2),l("queryParams",K(16,At,y.navigation.$domain(),i.uid))("textContent",i.name||"\u672A\u5165\u529B"),c(4),V("btn-success",i.viewFlag)("border",!i.viewFlag)("disabled",i._==null?null:i._.isWait),l("disabled",i._==null?null:i._.isWait)("textContent",i.viewFlag?"\u516C\u958B\u4E2D":"\u975E\u516C\u958B"),c(),w((n=r)?15:-1,n)}}function zt(a,e){if(a&1&&(s(0,"div",8)(1,"div",26),M(2,Qt,16,19,"div",null,Et),o()()),a&2){let t=e,n=d(2);c(),l("nxtSortablejs",t)("config",n.castListSortableOptions),c(),A(t)}}function Yt(a,e){if(a&1){let t=L();s(0,"div",24)(1,"app-cast-section-list",41),g("actionClose",function(){m(t);let i=d(2);return u(i.$select_castSectionItem.set(void 0))}),o()()}if(a&2){let t=d(2);l("ngClass",t.$viewSettings_castSectionClass()),c(),l("select_castSectionItem",e)}}function Jt(a,e){if(a&1){let t=L();s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"strong"),p(5,"\u30AD\u30E3\u30B9\u30C8\u4E00\u89A7"),o()()(),s(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"span"),p(11,"\u691C\u7D22"),o()(),s(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),p(16," \u30AD\u30E3\u30B9\u30C8\u540D "),o(),s(17,"input",12),g("ngModelChange",function(i){m(t);let r=d();return r.$q_castName.set(i),u(r.action_load_castList())}),o()(),s(18,"div",10)(19,"div",11),p(20,"\u516C\u958B\u72B6\u614B"),o(),s(21,"select",13),g("ngModelChange",function(i){m(t);let r=d();return r.$q_viewFlag.set(i),u(r.action_load_castList())}),s(22,"option",14),p(23,"\u5168\u3066"),o(),s(24,"option",14),p(25,"\u8868\u793A\u4E2D"),o(),s(26,"option",14),p(27,"\u975E\u8868\u793A"),o()()(),s(28,"div",10)(29,"div",11),p(30,"\u8868\u793A\u4EF6\u6570"),o(),s(31,"select",13),g("ngModelChange",function(i){m(t);let r=d();return r.$q_limit.set(i),u(r.action_load_castList())}),M(32,Bt,2,4,"option",15,z),o()(),s(34,"div",10)(35,"div",11),p(36,"\u30DA\u30FC\u30B8"),o(),s(37,"input",16),g("ngModelChange",function(i){m(t);let r=d();return r.$q_page.set(i),u(r.action_load_castList())})("wheel",function(){m(t);let i=d();return u(i.util.noop())}),o()()()()(),s(38,"div",6)(39,"div",7),p(40,"\u8A2D\u5B9A"),o(),s(41,"div",8)(42,"div",10)(43,"div",11),p(44,"\u30BB\u30AF\u30B7\u30E7\u30F3(\u5E45)"),o(),s(45,"select",17),g("ngModelChange",function(i){m(t);let r=d();return u(r.$viewSettings_castSectionClass.set(i))}),M(46,Rt,2,3,"option",14,z),T(48,"repeat"),o()()()(),s(49,"div",6)(50,"div",7)(51,"span"),p(52,"\u64CD\u4F5C"),o()(),s(53,"div",8),J(54)(55),s(56,"div",18)(57,"span",19),p(58,"\u30BB\u30AF\u30B7\u30E7\u30F3"),o(),M(59,Pt,1,5,"button",20,Et),o()()(),s(61,"div",6)(62,"div",7)(63,"div",21)(64,"div")(65,"span"),p(66,"\u4E00\u89A7"),o(),J(67),$(68,Ut,2,3,"span",22),o(),s(69,"div")(70,"i",23),g("click",function(){m(t);let i=d();return u(i.action_load_castList())}),o()()()(),$(71,zt,4,2,"div",8),o()()()(),$(72,Yt,2,2,"div",24),o()}if(a&2){let t,n,i=d();c(17),l("ngModel",i.$q_castName()),c(4),l("ngModel",i.$q_viewFlag()),c(),l("ngValue",void 0),c(2),l("ngValue",!0),c(2),l("ngValue",!1),c(5),l("ngModel",i.$q_limit()),c(),A(k(20,Wt)),c(5),l("min",1)("ngModel",i.$q_page()),c(8),l("ngModel",i.$viewSettings_castSectionClass()),c(),A(st(48,14,6,1)),c(8);let r=F(i.$select_castSectionItem());c(),F(r==null?null:r.uid),c(4),A(i.$castSectionItemList()),c(8);let y=F(i.$castListCount());c(),w(i.util.isNumber(y)?68:-1),c(2),V("fa-spin",i.$load_castList_isWait()),c(),w((t=i.$castList())?71:-1,t),c(),w((n=i.$select_castSectionItem())?72:-1,n)}}function Kt(a,e){a&1&&(s(0,"div"),p(1,"loading..."),o())}var X=class a{#t=v(I);util=v(R);navigation=v(wt);api=v(B);activatedRoute=v(ut);notifyMessage=v(j);changeDetectorRef=v(dt);noimage=v(O);Math=Math;$viewSettings_castSectionClass=Ct("CastListComponent.$viewSettings_castSectionClass",{defaultValue:"col-2"});castListSortableOptions={handle:".handle",onUpdate:()=>{this.notifyMessage.show("\u4FDD\u5B58\u4E2D...");let e={};{let t=Date.now(),n=this.$castList()||[];e.castList=n.map(i=>x(h({},i),{sort:t--}))}this.api.post("page/castList/save_castList_sort",e).pipe(C(this.#t),f(()=>{this.$castList.set(e.castList),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")}),S(1)).subscribe()}};$isReady=_(!1);$queryParams=gt();$q_castName=_("");$q_viewFlag=_(void 0);$q_limit=_(100);$q_page=_(1);$params=W(()=>{let e={query:{}};return e.query.name=this.$q_castName(),e.query.viewFlag=this.$q_viewFlag(),e.query.limit=this.$q_limit(),e.query.offset=(this.$q_page()-1)*this.$q_limit(),e});$pageConfig=_(void 0);$castList=_(void 0);$castListCount=_(void 0);$castImageItem=_(void 0);$castSectionItemList=_(void 0);action_select_castSelectionItem(e){let t=this.$select_castSectionItem();this.$select_castSectionItem.set(t?.uid===e.uid?void 0:e)}$select_castSectionItem=_(void 0);$castSectionListComponent=lt(E);constructor(){this.activatedRoute.queryParams.pipe(C(this.#t),f(()=>this.$isReady.set(!1)),Q(()=>this.load()),f(()=>this.$isReady.set(!0))).subscribe()}load(){this.$castList.set(void 0),this.$castListCount.set(void 0);let e=this.$params();return this.api.post("page/castList/load",e).pipe(C(this.#t),f(({results:t})=>{let{pageConfig:n,castList:i,castListCount:r,castImageItem:y,castSectionItemList:It}=t;this.$pageConfig.set(n||{}),this.$castList.set(i||[]),this.$castListCount.set(r||0),this.$castImageItem.set(y||{}),this.$castSectionItemList.set(It||[])}),S(1))}action_load(){this.load().pipe(C(this.#t),S(1)).subscribe()}$load_castList_isWait=_(!1);load_castList(){this.$load_castList_isWait.set(!0),this.$castList.set(void 0),this.$castListCount.set(void 0);let e=this.$params();return this.api.post("page/castList/load_castList",e).pipe(C(this.#t),f(({results:t})=>{this.$castList.set(t.castList||[]),this.$castListCount.set(t.castListCount||0),this.$load_castList_isWait.set(!1)}),S(1))}load_castList$=(()=>{let e=new Z;return e.pipe(C(this.#t),Q(()=>this.load_castList())).subscribe(),e})();action_load_castList(){this.load_castList$.next(null)}remove_cast(e){let t={cast:x(h({},e),{_:null})};return this.api.post("page/castList/remove_cast",t).pipe(C(this.#t),f(()=>{this.$castList.update(n=>n.filter(i=>i.uid!==t.cast.uid)),this.$castListCount.update(n=>n-1)}),S(1))}action_remove_cast(e){confirm("\u524A\u9664\u306F\u53D6\u308A\u6D88\u305B\u307E\u305B\u3093\u3002")&&this.remove_cast(e).pipe(C(this.#t),S(1)).subscribe()}action_cast_viewFlag(e){this.notifyMessage.show("\u4FDD\u5B58\u4E2D..."),e._=x(h({},e._),{isWait:!0});let t={cast:x(h({},e),{viewFlag:!e.viewFlag,_:null})};this.api.post("page/castList/save_cast_viewFlag",t).pipe(C(this.#t)).pipe(f(({results:n})=>{e.viewFlag=!!t.cast.viewFlag,e._=x(h({},e._),{isWait:!1}),this.changeDetectorRef.markForCheck(),this.notifyMessage.hide("\u4FDD\u5B58\u3057\u307E\u3057\u305F")})).subscribe()}add_castSection(e){this.$castSectionListComponent()?.add_castSection(e)?.pipe(C(this.#t),f(console.log),S(1))?.subscribe()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=N({type:a,selectors:[["app-cast-list"]],viewQuery:function(t,n){t&1&&nt(n.$castSectionListComponent,E,5),t&2&&at()},hostAttrs:[1,"h-100"],decls:2,vars:1,consts:[[1,"d-flex","flex-row","h-100"],[1,"card","w-100","h-100","user-select-none","p-0","m-0","rounded-0"],[1,"card-header","rounded-0","p-0"],[1,"p-1"],[1,"card-body","p-1","m-0","overflow-y-scroll"],[1,"d-flex","flex-column","gap-1"],[1,"card"],[1,"card-header","p-0","px-1"],[1,"card-body","p-1"],[1,"d-flex","flex-row","flex-wrap","gap-1"],[1,"input-group","input-group-sm","w-auto"],[1,"input-group-text"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue","textContent"],["type","number",1,"form-control","form-control-sm",2,"width","4rem",3,"ngModelChange","wheel","min","ngModel"],[1,"form-select","form-select-sm",2,"width","5rem",3,"ngModelChange","ngModel"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-secondary-subtle"],[1,"btn","btn-sm","border",3,"btn-light","btn-success","textContent"],[1,"d-flex","flex-row","justify-content-between","px-1"],[1,"mx-1","label-count",3,"textContent"],[1,"fa","fa-refresh","fa-hover","cursor-pointer",3,"click"],[1,"h-100","overflow-y-hidden",3,"ngClass"],[1,"btn","btn-sm","border",3,"click","textContent"],[1,"d-flex","flex-wrap","gap-1","col",3,"nxtSortablejs","config"],[1,"card","m-0","h-100",2,"width","200px"],[1,"card-header","p-1","d-flex","flex-row","justify-content-between","g-1"],[1,"fa","fa-arrows","handle","fa-hover","cursor-move","handle"],[1,"fa","fa-times","text-danger","fa-hover","cursor-pointer",3,"click"],[1,"card-body","p-0","h-100"],[1,"d-flex","flex-column","justify-content-between","h-100"],["routerLink","/castEdit",1,"p-0","cursor-pointer","h-100",3,"queryParams"],["loading","lazy",1,"w-100",3,"src"],[1,"px-1","py-1",2,"white-space","nowrap","text-overflow","ellipsis","overflow","hidden"],["routerLink","/castEdit",3,"queryParams","textContent"],[1,"card-footer","p-1","text-center","bg-white"],[1,"btn","btn-sm",3,"click","disabled","textContent"],[1,"text-center"],[1,"btn","border","btn-sm",3,"click"],[3,"actionClose","select_castSectionItem"]],template:function(t,n){t&1&&$(0,Jt,73,21,"div",0)(1,Kt,2,0,"div"),t&2&&w(n.$isReady()?0:1)},dependencies:[$t,xt,Lt,ft,bt,ht,vt,yt,St,_t,U,P,E,pt,mt,Mt],encapsulation:2})};export{X as default};
